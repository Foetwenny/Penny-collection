<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elongated Penny Collection</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="album-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google AI Configuration -->
    <script>
        // Google AI Configuration - Load from config file
        window.GOOGLE_AI_CONFIG = {
            apiKey: '',
            projectId: ''
        };
        
        // Load configuration from external file
        fetch('./config.js')
            .then(response => response.text())
            .then(configText => {
                // Extract API key and project ID from config
                const apiKeyMatch = configText.match(/apiKey:\s*['"]([^'"]+)['"]/);
                const projectIdMatch = configText.match(/projectId:\s*['"]([^'"]+)['"]/);
                
                if (apiKeyMatch) window.GOOGLE_AI_CONFIG.apiKey = apiKeyMatch[1];
                if (projectIdMatch) window.GOOGLE_AI_CONFIG.projectId = projectIdMatch[1];
                
                if (!window.GOOGLE_AI_CONFIG.apiKey) {
                    console.warn('API key not found. Please check your config.js file.');
                }
            })
            .catch(error => {
                console.error('Failed to load configuration:', error);
                console.warn('Please create a config.js file with your API credentials.');
            });
    </script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-coins"></i> Traveler's Penny Log <i class="fas fa-globe"></i></h1>
                <p>Organize and display your pressed penny treasures</p>
                <div class="header-actions">
                    <div class="search-container">
                        <input type="text" id="searchInput" class="search-input" placeholder="Search albums, locations, descriptions...">
                        <button id="clearSearchBtn" class="clear-search-btn" style="display: none;" onclick="clearSearch()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <button id="createAlbumBtn" class="create-album-btn" onclick="openCreateAlbumModal()">
                        <i class="fas fa-plus"></i> Create New Album
                    </button>
                    <button id="darkModeToggle" class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="menu-dropdown">
                        <button id="menuToggle" class="menu-toggle" onclick="toggleMenu()" title="Menu">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div id="menuDropdown" class="menu-dropdown-content">
                            <div class="menu-section">
                                <h4>Collection Management</h4>
                                <button onclick="exportAlbums()" class="menu-item">
                                    <i class="fas fa-download"></i> Export Backup
                                </button>
                                <button onclick="importAlbums()" class="menu-item">
                                    <i class="fas fa-upload"></i> Import Backup
                                </button>
                            </div>
                            <div class="menu-section">
                                <h4>Search & Sort</h4>
                                <button onclick="openAdvancedSearch()" class="menu-item">
                                    <i class="fas fa-search-plus"></i> Advanced Search
                                </button>
                                <button onclick="openSortOptions()" class="menu-item">
                                    <i class="fas fa-sort"></i> Sort Options
                                </button>
                                <button onclick="openFilterSettings()" class="menu-item">
                                    <i class="fas fa-filter"></i> Filter Settings
                                </button>
                            </div>
                            <div class="menu-section">
                                <h4>App Settings</h4>
                                <button onclick="openCollectionSettings()" class="menu-item">
                                    <i class="fas fa-edit"></i> Collection Name
                                </button>
                                <button onclick="openAIConfig()" class="menu-item">
                                    <i class="fas fa-robot"></i> AI Configuration
                                </button>
                                <button onclick="openDisplayPreferences()" class="menu-item">
                                    <i class="fas fa-palette"></i> Display Preferences
                                </button>
                                <button onclick="openCollectionDefaults()" class="menu-item">
                                    <i class="fas fa-cog"></i> Collection Defaults
                                </button>
                            </div>
                            <div class="menu-section">
                                <h4>Help & Info</h4>
                                <button onclick="openUserGuide()" class="menu-item">
                                    <i class="fas fa-book-open"></i> User Guide
                                </button>
                                <button onclick="openAbout()" class="menu-item">
                                    <i class="fas fa-info-circle"></i> About
                                </button>
                                <button onclick="openVersionInfo()" class="menu-item">
                                    <i class="fas fa-code-branch"></i> Version Info
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Search Results Section -->
        <div id="searchResultsSection" class="search-results-section" style="display: none;">
            <div class="search-results-header">
                <div class="search-results-info">
                    <span id="searchResultsCount">0 results</span>
                    <span id="searchResultsQuery"></span>
                </div>
                <button id="showAllAlbumsBtn" class="show-all-btn" onclick="showAllAlbums()">
                                                    <i class="fas fa-times"></i> Clear Search
                </button>
            </div>
        </div>

        <main class="main-content">
            <!-- Album Management Section -->
            <section class="album-section">
                <div class="album-header">
                    <h2>
                        <i class="fas fa-book"></i> <span id="collectionNameDisplay">Your Albums</span>
                        <div class="sort-indicator" id="sortIndicator">
                            <i class="fas fa-sort"></i>
                            <span id="sortIndicatorText">Sorted by Date Created (Newest First)</span>
                        </div>
                    </h2>
                </div>
                
                <div class="albums-grid" id="albumsGrid">
                    <!-- Albums will be dynamically added here -->
                </div>
                
                <div class="empty-albums-state" id="emptyAlbumsState" style="display: none;">
                    <i class="fas fa-book-open"></i>
                    <h3>No Albums Yet</h3>
                    <p>Create your first album to start organizing your penny collection!</p>
                    <button class="create-album-btn" onclick="openCreateAlbumModal()">
                        <i class="fas fa-plus"></i> Create Your First Album
                    </button>
                </div>
            </section>
        
            <!-- Create Album Modal -->
            <div class="modal" id="createAlbumModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Create New Album</h3>
                        <button class="close-btn" onclick="closeCreateAlbumModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="createAlbumForm">
                            <div class="form-group">
                                <label for="albumName">Album Name:</label>
                                <input type="text" id="albumName" required placeholder="e.g., Disney Collection, National Parks">
                            </div>
                            <div class="form-group">
                                <label for="albumDescription">Description:</label>
                                <textarea id="albumDescription" rows="3" placeholder="Describe what this album contains..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="albumCategory">Categories:</label>
                                <div class="category-checkboxes" id="albumCategoryCheckboxes">
                                    <div class="category-checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Theme Parks" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Theme Parks
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="National Parks" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            National Parks
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Historical Sites" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Historical Sites
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Museums" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Museums
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Zoos & Aquariums" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Zoos & Aquariums
                                        </label>
                                    </div>
                                    <div class="category-checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Mountains & Hiking" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Mountains & Hiking
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Cities & Urban" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Cities & Urban
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Small Towns" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Small Towns
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Road Trips" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Road Trips
                                        </label>
                                    </div>
                                    <div class="category-checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Vacation Destinations" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Vacation Destinations
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Educational" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Educational
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Entertainment" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Entertainment
                                        </label>
                                    </div>
                                    <div class="category-checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Sports & Recreation" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Sports & Recreation
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Cultural Events" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Cultural Events
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Seasonal" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Seasonal
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Other" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Other
                                        </label>
                                    </div>
                                </div>
                                <small>Select one or more categories to help organize and search your albums.</small>
                            </div>
                            <div class="form-group">
                                <label for="albumTripDate">Trip Date:</label>
                                <input type="date" id="albumTripDate">
                            </div>
                            <div class="form-group">
                                <label for="albumLocation">Location:</label>
                                <input type="text" id="albumLocation" placeholder="e.g., Disneyland, Yellowstone National Park">
                            </div>
                            <div class="form-group">
                                <label for="albumLocationUrl">Location URL (optional):</label>
                                <input type="url" id="albumLocationUrl" placeholder="https://earth.google.com/... or any map link">
                                <small>Add a Google Earth or map link to make the location clickable on the album card.</small>
                            </div>
                            <div class="form-group">
                                <label for="albumImageUrl">Background Image URL (optional):</label>
                                <input type="url" id="albumImageUrl" placeholder="https://i.imgur.com/... or any image URL">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="cancel-btn" onclick="closeCreateAlbumModal()">Cancel</button>
                        <button class="save-btn" onclick="createAlbum()">Create Album</button>
                    </div>
                </div>
            </div>
        
            <!-- Album View (Full Screen) -->
            <div id="albumViewScreen" class="album-view-screen" style="display: none;">
                <div class="album-view-header">
                    <button class="back-btn" onclick="closeAlbumView()">
                        <i class="fas fa-arrow-left"></i> Back to Albums
                    </button>
                    <div class="album-view-title">
                        <h2 id="albumViewTitle">Album Name</h2>
                        <button class="add-penny-btn" onclick="openAddPennyModal()">
                            <i class="fas fa-plus"></i> Add Penny
                        </button>
                        <button class="edit-album-btn" onclick="editCurrentAlbum()">
                            <i class="fas fa-edit"></i> Edit Album
                        </button>
                        <button class="delete-album-btn" onclick="deleteCurrentAlbum()">
                            <i class="fas fa-trash"></i> Delete Album
                        </button>
                    </div>
                </div>
                
                <div class="album-view-content">
                    <div class="album-info" id="albumInfo">
                        <!-- Album info will be displayed here -->
                    </div>

                    <!-- Analysis Results -->
                    <div class="analysis-section" id="analysisSection" style="display: none;">
                        <div class="analysis-card">
                            <h4><i class="fas fa-brain"></i> AI Analysis Results</h4>
                            <div class="analysis-content">
                                <div class="analysis-item">
                                    <label>Location:</label>
                                    <input type="text" id="locationResult" placeholder="Enter location here" class="analysis-input">
                                </div>
                                <div class="analysis-item">
                                    <label>Description:</label>
                                    <p id="descriptionResult">Analyzing...</p>
                                </div>
                                <div class="analysis-item">
                                    <label>Estimated Date:</label>
                                    <span id="dateResult">Analyzing...</span>
                                </div>
                            </div>
                            <div class="analysis-actions">
                                <button class="save-btn" id="saveBtn">
                                    <i class="fas fa-save"></i> Save to Album
                                </button>
                                <button class="edit-btn" id="editBtn">
                                    <i class="fas fa-edit"></i> Edit Details
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Pennies in Album -->
                    <div class="album-pennies">
                        <h4><i class="fas fa-coins"></i> Pennies in this Album</h4>
                        <div class="pennies-grid" id="penniesGrid">
                            <!-- Pennies will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- Edit Penny Modal -->
            <div class="modal" id="editModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Edit Penny Details</h3>
                        <button class="close-btn" onclick="closeModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="editForm">
                            <div class="form-group">
                                <label for="editName">Name/Title:</label>
                                <input type="text" id="editName" required>
                            </div>
                            <div class="form-group">
                                <label for="editLocation">Location:</label>
                                <input type="text" id="editLocation" required>
                            </div>
                            <div class="form-group">
                                <label for="editDescription">Description:</label>
                                <textarea id="editDescription" rows="4" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="editDate">Date Collected:</label>
                                <input type="date" id="editDate">
                            </div>
                            <div class="form-group">
                                <label for="editNotes">Personal Notes:</label>
                                <textarea id="editNotes" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="cancel-btn" onclick="closeModal()">Cancel</button>
                        <button class="save-btn" onclick="saveEdit()">Save Changes</button>
                    </div>
                </div>
            </div>

            <!-- Edit Album Modal -->
            <div class="modal" id="editAlbumModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Edit Album</h3>
                        <button class="close-btn" onclick="closeEditAlbumModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="editAlbumForm">
                            <div class="form-group">
                                <label for="editAlbumName">Album Name:</label>
                                <input type="text" id="editAlbumName" required>
                            </div>
                            <div class="form-group">
                                <label for="editAlbumDescription">Description:</label>
                                <textarea id="editAlbumDescription" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="editAlbumCategory">Categories:</label>
                                <div class="category-checkboxes" id="editAlbumCategoryCheckboxes">
                                    <div class="category-checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Theme Parks" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Theme Parks
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="National Parks" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            National Parks
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Historical Sites" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Historical Sites
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Museums" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Museums
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Zoos & Aquariums" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Zoos & Aquariums
                                        </label>
                                    </div>
                                    <div class="category-checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Mountains & Hiking" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Mountains & Hiking
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Cities & Urban" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Cities & Urban
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Small Towns" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Small Towns
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Road Trips" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Road Trips
                                        </label>
                                    </div>
                                    <div class="category-checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Vacation Destinations" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Vacation Destinations
                                        </label>

                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Educational" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Educational
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Entertainment" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Entertainment
                                        </label>
                                    </div>
                                    <div class="category-checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Sports & Recreation" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Sports & Recreation
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Cultural Events" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Cultural Events
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Seasonal" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Seasonal
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" value="Other" class="category-checkbox">
                                            <span class="checkmark"></span>
                                            Other
                                        </label>
                                    </div>
                                </div>
                                <small>Select one or more categories to help organize and search your albums.</small>
                            </div>
                            <div class="form-group">
                                <label for="editAlbumTripDate">Trip Date:</label>
                                <input type="date" id="editAlbumTripDate">
                            </div>
                            <div class="form-group">
                                <label for="editAlbumLocation">Location:</label>
                                <input type="text" id="editAlbumLocation" placeholder="e.g., Disneyland, Yellowstone National Park">
                            </div>
                            <div class="form-group">
                                <label for="editAlbumLocationUrl">Location URL (optional):</label>
                                <input type="url" id="editAlbumLocationUrl" placeholder="https://earth.google.com/... or any map link">
                                <small>Add a Google Earth or map link to make the location clickable on the album card.</small>
                            </div>
                            <div class="form-group">
                                <label for="editAlbumImageUrl">Background Image URL (optional):</label>
                                <input type="url" id="editAlbumImageUrl" placeholder="https://i.imgur.com/... or any image URL">
                            </div>
                            <div class="form-group">
                                <small>Tip: You can use public image links (e.g., Imgur). The image will be displayed as the album card background.</small>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="cancel-btn" onclick="closeEditAlbumModal()">Cancel</button>
                        <button class="save-btn" onclick="saveAlbumEdit()">Save Album</button>
                    </div>
                </div>
            </div>

            <!-- Add Penny Modal -->
            <div class="modal" id="addPennyModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Add New Penny</h3>
                        <button class="close-btn" onclick="closeAddPennyModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-content">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drag & drop an image here or click to browse</p>
                                <input type="file" id="imageInput" accept="image/*" hidden>
                                <button class="upload-btn" onclick="document.getElementById('imageInput').click()">
                                    Choose Image
                                </button>
                            </div>
                        </div>
                        <div class="upload-preview" id="uploadPreview" style="display: none;">
                            <img id="previewImage" src="" alt="Preview">
                            <div class="preview-actions">
                                <button class="analyze-btn" id="analyzeBtn">
                                    <i class="fas fa-magic"></i> Analyze with AI
                                </button>
                                <button class="manual-entry-btn" id="manualEntryBtn">
                                    <i class="fas fa-edit"></i> Enter Details Manually
                                </button>
                                <button class="reset-btn" onclick="resetUpload()">
                                    <i class="fas fa-times"></i> Reset
                                </button>
                            </div>
                        </div>
                        
                        <!-- Manual Entry Form -->
                        <div class="manual-entry-form" id="manualEntryForm" style="display: none;">
                            <h4><i class="fas fa-edit"></i> Penny Details</h4>
                            <form id="pennyEntryForm">
                                <div class="form-group">
                                    <label for="pennyName">Name/Title:</label>
                                    <input type="text" id="pennyName" required placeholder="What does this penny commemorate?">
                                </div>
                                <div class="form-group">
                                    <label for="pennyLocation">Location:</label>
                                    <input type="text" id="pennyLocation" required placeholder="Where did you collect this penny?">
                                </div>
                                <div class="form-group">
                                    <label for="pennyDescription">Description:</label>
                                    <textarea id="pennyDescription" rows="3" required placeholder="Describe the penny design and details..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="pennyDate">Date Collected:</label>
                                    <input type="date" id="pennyDate">
                                </div>
                                <div class="form-group">
                                    <label for="pennyNotes">Personal Notes:</label>
                                    <textarea id="pennyNotes" rows="2" placeholder="Any memories or observations..."></textarea>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Analysis Results -->
                        <div class="analysis-section" id="analysisSection" style="display: none;">
                            <div class="analysis-card">
                                <h4><i class="fas fa-brain"></i> AI Analysis Results</h4>
                                <div class="analysis-content">
                                    <div class="analysis-item">
                                        <label>Location:</label>
                                        <input type="text" id="locationResult" placeholder="Enter location here" class="analysis-input">
                                    </div>
                                    <div class="analysis-item">
                                        <label>Description:</label>
                                        <p id="descriptionResult" class="description-text">Analyzing...</p>
                                    </div>
                                    <div class="analysis-item">
                                        <label>Estimated Date:</label>
                                        <span id="dateResult">Analyzing...</span>
                                    </div>
                                </div>
                                <div class="analysis-actions">
                                    <button class="save-btn" id="saveBtn">
                                        <i class="fas fa-save"></i> Save to Album
                                    </button>
                                    <button class="edit-btn" id="editBtn">
                                        <i class="fas fa-edit"></i> Edit Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="cancel-btn" onclick="closeAddPennyModal()">Cancel</button>
                        <button class="save-btn" id="saveManualPennyBtn" style="display: none;" onclick="saveManualPenny()">
                            <i class="fas fa-save"></i> Save Penny
                        </button>
                    </div>
                </div>
            </div>

            <!-- Penny View Modal -->
            <div class="modal" id="pennyViewModal">
                <div class="modal-content penny-view-content">
                    <div class="modal-header">
                        <h3 id="pennyViewTitle">Penny Details</h3>
                        <button class="close-btn" onclick="closePennyViewModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="penny-view-image">
                            <img id="pennyViewImage" src="" alt="Penny Image">
                        </div>
                        <div class="penny-view-info">
                            <h4 id="pennyViewName"></h4>
                            <p><strong>Location:</strong> <span id="pennyViewLocation"></span></p>
                            <p><strong>Date Collected:</strong> <span id="pennyViewDate"></span></p>
                            <p><strong>Description:</strong></p>
                            <p id="pennyViewDescription"></p>
                            <p style="display: none;"><strong>Personal Notes:</strong></p>
                            <p id="pennyViewNotes" style="display: none;"></p>
                        </div>
                    </div>
                </div>
            </div>

                         <!-- Sort Options Modal -->
             <div class="modal" id="sortOptionsModal">
                 <div class="modal-content">
                     <div class="modal-header">
                         <h3><i class="fas fa-sort"></i> Sort Albums</h3>
                         <button class="close-btn" onclick="closeSortOptionsModal()">
                             <i class="fas fa-times"></i>
                         </button>
                     </div>
                     <div class="modal-body">
                         <div class="sort-options">
                             <div class="sort-option">
                                 <label class="sort-option-label">
                                     <input type="radio" name="sortBy" value="dateCreated" class="sort-radio">
                                     <span class="radio-checkmark"></span>
                                     <span class="sort-text">Date Created</span>
                                 </label>
                                 <div class="sort-direction">
                                     <button class="direction-btn" data-sort="dateCreated" data-direction="desc">
                                         <i class="fas fa-sort-amount-down"></i> Newest First
                                     </button>
                                     <button class="direction-btn" data-sort="dateCreated" data-direction="asc">
                                         <i class="fas fa-sort-amount-up"></i> Oldest First
                                     </button>
                                 </div>
                             </div>

                             <div class="sort-option">
                                 <label class="sort-option-label">
                                     <input type="radio" name="sortBy" value="tripDate" class="sort-radio">
                                     <span class="radio-checkmark"></span>
                                     <span class="sort-text">Trip Date</span>
                                 </label>
                                 <div class="sort-direction">
                                     <button class="direction-btn" data-sort="tripDate" data-direction="desc">
                                         <i class="fas fa-sort-amount-down"></i> Most Recent Trip
                                     </button>
                                     <button class="direction-btn" data-sort="tripDate" data-direction="asc">
                                         <i class="fas fa-sort-amount-up"></i> Oldest Trip
                                     </button>
                                 </div>
                             </div>

                             <div class="sort-option">
                                 <label class="sort-option-label">
                                     <input type="radio" name="sortBy" value="albumName" class="sort-radio">
                                     <span class="radio-checkmark"></span>
                                     <span class="sort-text">Album Name</span>
                                 </label>
                                 <div class="sort-direction">
                                     <button class="direction-btn" data-sort="albumName" data-direction="asc">
                                         <i class="fas fa-sort-alpha-down"></i> A to Z
                                     </button>
                                     <button class="direction-btn" data-sort="albumName" data-direction="desc">
                                         <i class="fas fa-sort-alpha-up"></i> Z to A
                                     </button>
                                 </div>
                             </div>

                             <div class="sort-option">
                                 <label class="sort-option-label">
                                     <input type="radio" name="sortBy" value="location" class="sort-radio">
                                     <span class="radio-checkmark"></span>
                                     <span class="sort-text">Location</span>
                                 </label>
                                 <div class="sort-direction">
                                     <button class="direction-btn" data-sort="location" data-direction="asc">
                                         <i class="fas fa-sort-alpha-down"></i> A to Z
                                     </button>
                                     <button class="direction-btn" data-sort="location" data-direction="desc">
                                         <i class="fas fa-sort-alpha-up"></i> Z to A
                                     </button>
                                 </div>
                             </div>

                             <div class="sort-option">
                                 <label class="sort-option-label">
                                     <input type="radio" name="sortBy" value="pennyCount" class="sort-radio">
                                     <span class="radio-checkmark"></span>
                                     <span class="sort-text">Penny Count</span>
                                 </label>
                                 <div class="sort-direction">
                                     <button class="direction-btn" data-sort="pennyCount" data-direction="desc">
                                         <i class="fas fa-sort-amount-down"></i> Most Pennies
                                     </button>
                                     <button class="direction-btn" data-sort="pennyCount" data-direction="asc">
                                         <i class="fas fa-sort-amount-up"></i> Least Pennies
                                     </button>
                                 </div>
                             </div>

                             <div class="sort-option">
                                 <label class="sort-option-label">
                                     <input type="radio" name="sortBy" value="lastModified" class="sort-radio">
                                     <span class="radio-checkmark"></span>
                                     <span class="sort-text">Last Modified</span>
                                 </label>
                                 <div class="sort-direction">
                                     <button class="direction-btn" data-sort="lastModified" data-direction="desc">
                                         <i class="fas fa-sort-amount-down"></i> Recently Updated
                                     </button>
                                     <button class="direction-btn" data-sort="lastModified" data-direction="asc">
                                         <i class="fas fa-sort-amount-up"></i> Oldest Update
                                     </button>
                                 </div>
                             </div>
                         </div>
                     </div>
                     <div class="modal-footer">
                         <button class="cancel-btn" onclick="closeSortOptionsModal()">Cancel</button>
                         <button class="save-btn" onclick="applySort()">Apply Sort</button>
                     </div>
                 </div>
             </div>

             <!-- User Guide Modal -->
             <div class="modal" id="userGuideModal">
                 <div class="modal-content user-guide-content">
                     <div class="modal-header">
                         <h3><i class="fas fa-book-open"></i> User Guide</h3>
                         <button class="close-btn" onclick="closeUserGuideModal()">
                             <i class="fas fa-times"></i>
                         </button>
                     </div>
                     <div class="modal-body">
                         <div class="guide-navigation">
                             <button class="guide-nav-btn active" data-section="getting-started">Getting Started</button>
                             <button class="guide-nav-btn" data-section="albums">Albums</button>
                             <button class="guide-nav-btn" data-section="search-sort">Search & Sort</button>
                             <button class="guide-nav-btn" data-section="pennies">Pennies</button>
                             <button class="guide-nav-btn" data-section="features">Features</button>
                         </div>
                         
                         <div class="guide-content">
                             <!-- Getting Started Section -->
                             <div class="guide-section active" id="getting-started">
                                 <h4><i class="fas fa-rocket"></i> Getting Started</h4>
                                 <p>Welcome to Traveler's Penny Log! This app helps you organize and display your pressed penny collection.</p>
                                 
                                 <h5>Quick Start:</h5>
                                 <ol>
                                     <li><strong>Create Your First Album:</strong> Click the "Create New Album" button in the header</li>
                                     <li><strong>Add Details:</strong> Fill in the album name, description, and select categories</li>
                                     <li><strong>Add Pennies:</strong> Open the album and click "Add Penny" to start your collection</li>
                                 </ol>
                                 
                                 <h5>Navigation:</h5>
                                 <ul>
                                     <li><strong>Header:</strong> Search bar, create album button, dark mode toggle, and menu</li>
                                     <li><strong>Menu (⋮):</strong> Access to advanced features, settings, and help</li>
                                     <li><strong>Album Cards:</strong> Click to open full album view</li>
                                 </ul>
                             </div>
                             
                             <!-- Albums Section -->
                             <div class="guide-section" id="albums">
                                 <h4><i class="fas fa-book"></i> Managing Albums</h4>
                                 
                                 <h5>Creating Albums:</h5>
                                 <ul>
                                     <li><strong>Name:</strong> Choose a descriptive name for your collection</li>
                                     <li><strong>Description:</strong> Add details about what the album contains</li>
                                     <li><strong>Categories:</strong> Select one or more categories to help organize and search</li>
                                     <li><strong>Trip Date:</strong> When you visited the location (optional)</li>
                                     <li><strong>Location:</strong> Where you collected the pennies</li>
                                     <li><strong>Location URL:</strong> Add a map link to make the location clickable</li>
                                     <li><strong>Background Image:</strong> Add a cover image for visual appeal</li>
                                 </ul>
                                 
                                 <h5>Album Actions:</h5>
                                 <ul>
                                     <li><strong>View:</strong> Click the album card to see all details and pennies</li>
                                     <li><strong>Edit:</strong> Modify album information anytime</li>
                                     <li><strong>Delete:</strong> Remove albums you no longer need</li>
                                 </ul>
                             </div>
                             
                             <!-- Search & Sort Section -->
                             <div class="guide-section" id="search-sort">
                                 <h4><i class="fas fa-search"></i> Search & Organization</h4>
                                 
                                 <h5>Search:</h5>
                                 <ul>
                                     <li><strong>Search Bar:</strong> Find albums by name, description, location, or penny details</li>
                                     <li><strong>Categories:</strong> Search by album categories (e.g., "Theme Parks", "National Parks")</li>
                                     <li><strong>Results:</strong> See highlighted matches and which fields contained your search term</li>
                                     <li><strong>Matched Pennies:</strong> When opening an album from search results, matching pennies appear first in the grid</li>
                                 </ul>
                                 
                                 <h5>Sorting:</h5>
                                 <ul>
                                     <li><strong>Date Created:</strong> Newest or oldest albums first</li>
                                     <li><strong>Trip Date:</strong> Most recent or oldest trips first</li>
                                     <li><strong>Album Name:</strong> Alphabetical order (A-Z or Z-A)</li>
                                     <li><strong>Location:</strong> Alphabetical by location</li>
                                     <li><strong>Penny Count:</strong> Most or least pennies first</li>
                                     <li><strong>Last Modified:</strong> Recently updated albums first</li>
                                 </ul>
                                 
                                 <p><strong>Tip:</strong> Your sort preference is saved and applied automatically!</p>
                             </div>
                             
                             <!-- Pennies Section -->
                             <div class="guide-section" id="pennies">
                                 <h4><i class="fas fa-coins"></i> Managing Pennies</h4>
                                 
                                 <h5>Adding Pennies:</h5>
                                 <ul>
                                     <li><strong>Upload Image:</strong> Drag & drop or click to browse for penny photos</li>
                                     <li><strong>AI Analysis:</strong> Use AI to automatically identify location and details (optional)</li>
                                     <li><strong>Manual Entry:</strong> Enter all penny details manually without AI analysis</li>
                                     <li><strong>Flexible Workflow:</strong> Choose between AI assistance or manual entry based on your preference</li>
                                 </ul>
                                 
                                 <h5>Penny Information:</h5>
                                 <ul>
                                     <li><strong>Name/Title:</strong> What the penny commemorates</li>
                                     <li><strong>Location:</strong> Where you collected it</li>
                                     <li><strong>Description:</strong> Details about the penny design</li>
                                     <li><strong>Date Collected:</strong> When you got the penny</li>
                                     <li><strong>Personal Notes:</strong> Your memories or observations</li>
                                 </ul>
                                 
                                 <h5>Penny Actions:</h5>
                                 <ul>
                                     <li><strong>View:</strong> Click penny images to see full details</li>
                                     <li><strong>Edit:</strong> Modify penny information anytime</li>
                                     <li><strong>Delete:</strong> Remove pennies from albums</li>
                                 </ul>
                             </div>
                             
                             <!-- Features Section -->
                             <div class="guide-section" id="features">
                                 <h4><i class="fas fa-star"></i> App Features</h4>
                                 
                                 <h5>Dark Mode:</h5>
                                 <p>Toggle between light and dark themes using the moon icon in the header.</p>
                                 
                                 <h5>Data Management:</h5>
                                 <ul>
                                     <li><strong>Export Backup:</strong> Download your collection as a JSON file</li>
                                     <li><strong>Import Backup:</strong> Restore your collection from a backup file</li>
                                     <li><strong>Local Storage:</strong> All data is saved locally in your browser</li>
                                 </ul>
                                 
                                 <h5>Menu Features:</h5>
                                 <ul>
                                     <li><strong>Collection Management:</strong> Backup and restore your data</li>
                                     <li><strong>Search & Sort:</strong> Advanced search and sorting options</li>
                                     <li><strong>App Settings:</strong> Configure AI and display preferences</li>
                                     <li><strong>Help & Info:</strong> Access this guide and app information</li>
                                 </ul>
                                 
                                 <h5>Tips:</h5>
                                 <ul>
                                     <li>Use categories to organize related albums (e.g., "Theme Parks" + "Family Vacations")</li>
                                     <li>Add location URLs to make album cards clickable for maps</li>
                                     <li>Search works across all album and penny fields</li>
                                     <li>Your preferences (dark mode, sort order) are automatically saved</li>
                                 </ul>
                             </div>
                         </div>
                     </div>
                     <div class="modal-footer">
                         <button class="cancel-btn" onclick="closeUserGuideModal()">Close Guide</button>
                         <button class="guide-nav-btn" onclick="openUserGuideInNewTab()">
                             <i class="fas fa-external-link-alt"></i> Open in New Tab
                         </button>
                     </div>
                 </div>
             </div>
        </main>
    </div>



    <script src="config.js"></script>
    <script src="script.js"></script>
</body>
</html>
